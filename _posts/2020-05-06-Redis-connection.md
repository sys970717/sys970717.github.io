---
layout: post
title: Redis 연동을 활용한 DynamoDB Scan 줄이기.
date: 2020. 05. 11
categories: NodeJS Redis
---

## 인사말

안녕하세요!! 이번 포스팅은 이제 막 처음 연동해본 Redis 에 대한 내용으로 짧막하게나마 남겨보려고 합니다.

## 본론
이전까진 프로젝트 기간 맞추느라 기능 쳐내기에 바빴는데, 조금의 여유를 되찾고 다시 보기 시작하는 서비스에 대한 내용입니다.
얼마 전 개발했던 명언 서비스에 대해서 대략 50개의 명언 리스트를 받았었습니다. 그리고 요구 기능은 이랬습니다.
"하루하루 랜덤으로 문구가 나왔으면 좋곘어요~"

이 말을 듣고 생각했었습니다, '하루하루 다른 데이터가 나오게는 할 수 있는데 랜덤하게 할 방법은 뭐가 있을까? 간단하지만 모든 회원이 다른
문구를 보는 것이 아니라 같은 날엔 모두가 같은 문구를 볼 수 있도록 하는 거..' 그렇다면 생각해볼 수 있는 것은 DB에 하루하루 저장해서 보여주는 것이었습니다.
하지만 여기까지 생각하고서, 일정이 촉박해서 문구 인덱스 ( 1 ~ 4,50 )와 그 날의 일자를 매핑해서 가져오도록 개발했었습니다.
그러면서 총 필요한 명언의 개수는 최대 31개로 제한 되었고, 지금 31개가 하루하루 돌아가고 있습니다..(^^) 다른 분들은 못느낄 수도 있지만 누군가가 발견한다면
패턴을 인지하고 물어봤겠지만 아직 제게 이걸로 태클 건 사람은 없었습니다. ~~너무다행..~~

그래서 이젠 바꾸자! 싶어서 어떻게 할까 하다가 향후 CMS 관련해서 Cron 작업 할 수 있으니까
``` Cron 서버를 만들고 하루에 한번씩 명언을 랜덤으로 돌리자!!```
라는 생각을 이제 다시 하게 되고, 그리고 서비스 속도를 위해 Redis 를 사용해서 퍼포먼스도 증가시키자!! 라는 생각으로 시작하게 됩니다.

작업은 NodeJS, TypeScript, redis, DynamoDB 를 사용했고, 기존 명언 리스트들은 모두 DynamoDB에 있습니다.

``` 대략적인 순서
 - DynamoDB 에 있는 모든 명언리스트를 호출한다. ( Scan )
 - 총 Length 값으로 랜덤 함수를 통해 Index를 구한다.
 - 해당 Index의 데이터를 Redis에 TTL 86400 ( 1일 ) 로 데이터를 삽입한다.
 - API 서버에서는 데이터를 가져올 때, Redis 에 접속하여 데이터를 가져오도록 한다.
```

라는 위의 순서로 진행했고, 테스트를 해봤을 때 문제 없었지만 cron 서버를 실제 서버 인스턴스에 올려 작업을 해봐야 알 수 있을 것 같습니다.





